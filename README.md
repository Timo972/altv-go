<div align="center">
  <h1>alt:V Go</h1>
  <a href="https://github.com/timo972/altv-go/actions/workflows/test-api.yml">
    <img src="https://github.com/timo972/altv-go/actions/workflows/test-api.yml/badge.svg" />
  </a>
	<a href="https://github.com/Timo972/altv-go/actions/workflows/test-module.yml">
    <img src="https://github.com/Timo972/altv-go/actions/workflows/test-module.yml/badge.svg" />
  </a>
	<a href="https://github.com/timo972/altv-go/actions/workflows/build-deploy-module.yml">
    <img src="https://github.com/timo972/altv-go/actions/workflows/build-deploy-module.yml/badge.svg" />
  </a>
  <a href="https://github.com/edgedb/edgedb/blob/master/LICENSE">
    <img alt="license" src="https://img.shields.io/badge/license-MIT-blue" />
  </a>
  <br />
  <br />
  <a href="https://altv-go.tbeck.dev/guide/get-started">Get started</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://altv-go.tbeck.dev">Docs</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://altv.mp">alt:V</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://discord.altv.mp">Discord</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://twitter.com/altVMP">Twitter</a>
  <br />

</div>
<br />

> Go package for alt:V Multiplayer. Runtime can be found [here](runtime).

<!-- > ⚠️ notice: i am too busy to keep this module updated even though no one is interested in it / using it.
> Create an issue or write me on Discord if you are interested or plan on using it, so i will continue updating / improving.
-->

> ⚠️ Notice: updated occasionally, not actively maintained  
> ⛔ Module is currently in development and not ready for production use - expect heavy api changes and bugs.  
> ✨ Contributions of any kind are always welcome!

## Requirements

Package depends heavily on [cgo](https://pkg.go.dev/cmd/cgo).
To build on Windows, a gcc compiler is required (ex: mingw-w64).

## Usage

Main function is left blank on purpose and must be included before building process.
Do not try to initialize stuff inside as it won't get called.

```go
package main

import "C"
import (
  "github.com/timo972/altv-go"
  // this package is a required import. if you are not using the event package, import it like this
  // _ "github.com/timo972/altv-go/event"
  // if you are not importing it, the module will log errors calling the ServerStarted and ResourceStopEvent
	"github.com/timo972/altv-go/event"
)

func init() {
	// You may want to initialize something here.
  // However the alt:V api is limited due to the reason
  // that the package did not load the go-module's c-api yet!
  // As of now you can only use the event features here.

  // e.g.
  event.On.ServerStarted(func () {
      altv.LogInfo("Server Started")
    })
}

// main function is left blank on purpose and must be included before building process
func main() {
	// You dont want to initialize something here because this wont work
}

//export OnStart
func OnStart() {
  // Full alt:V api is available. Do whatever you want.

	altv.LogInfo("Resource Started")
}

//export OnStop
func OnStop() {
	altv.LogInfo("Resource Stopped")
}
```

For more examples take a look at the [altv-go-examples]() repository.

## Building your Resource

#### Windows

```
go build -o my-resource.dll -buildmode=c-shared
```

#### Linux

```
go build -o my-resource.so -buildmode=c-shared
```

## Contributing

### Architecture

The go-module is split into three parts: the [runtime](/runtime), the [c-api](/internal/c-api) and the [go-api](/).

| Part    | Language | Description                                                                                                                             |
| ------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| Runtime | C++      | The runtime is the core of the module. It is responsible for initializing the go-module ScriptRuntime and loading the resource library. |
| C-API   | C        | The c-api is the interface between the runtime and the go-api. It is responsible for all go <-> runtime calls                           |
| Go-API  | Go       | The go-api is api you are using to build your custom gamemode. It utilizes the c-api to call alt:V functions exported by the runtime    |

The C-API is currently generated by a custom [nodejs script](/runtime/tools/pkg-capi.js).<br />
**DO NOT** edit the c-api files manually, as they will be overwritten on the next build.

### Build from source

#### Build the module
For instructions on how to build the go-module, take a look at the [Runtime Readme](/runtime/README.md).

#### Build the c-api
To build the **c-api** clone the repository:<br />
`git clone --recurse-submodules https://github.com/timo972/altv-go.git`

and run the following command:<br />
`make capi`

**Make sure** to delete the `internal/c-api/build/out` folder **everytime** before you rebuild the c-api.<br />
This is necessary to tell cmake to regenerate the c-api files based on the modules c exports.<br />
Afterwards replace the `internal/c-api/lib/capi.h` header with the new one from `internal/c-api/build/out/capi.h`.

I know this is not ideal. Already working on a better solution.

### Using your local build

To use your local version of the altv-go package, you need to add the following line to the go.mod file **of your resource**:

```
replace github.com/timo972/altv-go => ../relative/path/to/your/altv-go
```

This tells go to use the local version of the package instead of the one hosted on github.

---

## Help

If you need help to get started, contact me on Discord: `Timo9#4468`
