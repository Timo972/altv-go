# Contributing

## Architecture

The go-module is split into three parts: the [runtime](/runtime), the [c-api](/internal/c-api) and the [go-api](/).

| Part    | Language | Description                                                                                                                             |
| ------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| Runtime | C++      | The runtime is the core of the module. It is responsible for initializing the go-module ScriptRuntime and loading the resource library. |
| C-API   | C        | The c-api is the interface between the runtime and the go-api. It is responsible for all go <-> runtime calls                           |
| Go-API  | Go       | The go-api is api you are using to build your custom gamemode. It utilizes the c-api to call alt:V functions exported by the runtime    |

The C-API is currently generated by a custom [nodejs script](/runtime/tools/pkg-capi.js).<br />
**DO NOT** edit the c-api files manually, as they will be overwritten on the next build.

## Build from source

### Build the module
For instructions on how to build the go-module, take a look at the [Runtime Readme](/runtime/README.md).

### Build the c-api
Building the c-api constists of two parts:
- Generation of the c-api header & source file
- Actual build of the c-api using cmake

To build the **c-api** clone the repository:<br />
`git clone --recurse-submodules https://github.com/timo972/altv-go.git`

and run the following command:<br />
`make capi`

This will execute<br />
`
go run cmd/gencapi/*.go -cout=./internal/c-api/build/out/capi.c -hout=./internal/c-api/build/out/capi.h -hout=./internal/c-api/lib/capi.h  ./runtime/src/capi
`<br />
to generate the c-api header & source file and start the cmake build afterwards.

### Checking the build
To check if the build was successful, you can run the following command:<br />
``go test -v``<br />
This will run all tests in the root go package and errors in case the capi is not built correctly or incompatible with the go api. 

## Using your local build

To use your local version of the altv-go package, you need to add the following line to the go.mod file **of your resource**:

```
replace github.com/timo972/altv-go => ../relative/path/to/your/altv-go
```

This tells go to use the local version of the package instead of the one hosted on github.
